{% extends "main/base.html" %}
{% load url from future %}
{% load i18n %}
{% load notifications_tags %}
{% block head_title %}{% trans "HomeView" %}{% endblock %}
{% load static %}   
{% load bootstrap3 %}
{% block scripts %}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyCvfyKIBeaLLGXbF5HS73ZcfmDhPtM05rA&sensor=true"></script>

 <script src="{% static 'Gmaps/gmaps.js'%}"></script>
{% endblock %}
{% load static %}

{% block styles %}
     .map { height: 30em; }
{% endblock styles %}

{% block content %}
	<h1>Actualización {{object}}</h1>
    <form action="" method="POST">{% csrf_token %}
        
        {% bootstrap_form form%}
        <div class="form-group"><label class="control-label" for="id_mapa">Posición</label>
            <div class="map" id="id_mapa"></div>
        </div>
        <input type="hidden" id="latitude" value='{{lng}}'>
        <input type="hidden" id="longitude" value='{{lat}}'>
        <!--<textarea id="id_position" class="vWKTField required" cols="150" rows="10" name="position"></textarea>-->
        <br><br>
        <button type="submit" class="btn btn-success">{% trans "Actualizar" %}</button>
    </form>

    <script src="{% static 'js/update_categoria.js'%}"></script>   

   
            <script>    
var mapa= new GMaps({
  div: '#id_mapa',
  lat: $('#latitude').val(),
  lng: $('#longitude').val(),
    zoom: 16,
});

var myMarker = mapa.addMarker({
  lat: $('#latitude').val(),
  lng: $('#longitude').val(),
  draggable:true,
});

$('#id_position').hide();
$('#id_position').val("POINT ("+myMarker.getPosition().lng()+" "+myMarker.getPosition().lat()+")");

google.maps.event.addListener(myMarker, 'dragend', function() {
    console.log("TErminado: ");
    $('#latitude').val(myMarker.getPosition().lat());
    $('#longitude').val(myMarker.getPosition().lng());
    $('#id_position').val("POINT ("+myMarker.getPosition().lng()+" "+myMarker.getPosition().lat()+")");

     
  });

  
    </script>

{% endblock content %}
